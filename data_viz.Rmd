---
title: "Data Viz"
author: "Jake Riley"
date: "June 8, 2019"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  out.height = "300px"
)

library(tidyverse)
```

## today's talk

* Intro
* What is ggplot
* Tips & Tricks
* Best Practices
* Try it out

## an intro

* Jake Riley
* Clinical Data Analyst at Children's Hospital of Philadelphia
* Avid `ggplot2` answerer on stackoverflow
* dogdad

@yake_84


## what is ggplot?
 * grammar of graphics
 * just like every sentence has a **subject, verb, and noun**, every chart has a **coordinate system, geom, and aesthetics**
 * the hope is that we will invent new types of charts
 
```{r}
p <- 
  ggplot(mpg) + 
  geom_count(
    aes(cty, hwy, color = class), 
    alpha = 0.8
  ) +
  theme_bw()

```
 
 
## an example
```{r grammar, out.width=c('50%', '50%'), fig.show='hold'}
p

p + coord_polar()
```

## demystifying aes()

* `aes()` = aesthetics
* dynamic, data driven **variables** go inside the `aes()`
* constant, static **values** go outside

## note the difference
* `geom_point(aes(color = class, size = n), ...)`
* `geom_point(aes(...), color = "blue", size = 2)`

```{r out.width=c('50%', '50%'), fig.show='hold', echo=FALSE}
df <-
  mpg %>% 
  count(cyl = factor(cyl), cty, hwy)

ggplot(df, aes(x = cty, y = hwy)) +
  geom_point(aes(color = cyl, size = n))

ggplot(df, aes(x = cty, y = hwy)) +
  geom_point(color = "blue", size = 2)

```


## tips & tricks

## descending bar charts

The number one things I get asked is how to make a barchart go in descending order. 

```{r}
ggplot(mpg, aes(class)) + 
  geom_bar() + 
  coord_flip()
```

## arrange by volume: `fct_infreq()`
```{r}
mpg %>% 
  mutate(class = fct_infreq(class)) %>% 
  ggplot(aes(class)) + 
  geom_bar() + 
  coord_flip()
```

## arrange in descending order: `fct_rev()`
```{r, }
mpg %>% 
  mutate(class = fct_infreq(class)) %>% 
  ggplot(aes(fct_rev(class))) + 
  geom_bar() + 
  coord_flip()
```

## aggregated data: `fct_reorder()`
```{r}
mpg %>% 
  count(class) %>% 
  mutate(class = fct_reorder(class, n, sum))
```

## aggregated data: `fct_reorder()`
```{r}
mpg %>% 
  count(class) %>% 
  mutate(class = fct_reorder(class, n, sum)) %>% 
  ggplot(aes(class, n)) +
  geom_col() + 
  coord_flip()
```

## can you put this in descending order?
*(bonus) Can you do it without using a method I already mentioned?*
```{r}
mpg %>% 
  count(class) %>% 
  mutate(class = fct_reorder(class, n, sum)) %>% 
  ggplot(aes(class, n)) +
  geom_col() + 
  coord_flip()
```

## too many bars
```{r}
ggplot(mpg, aes(model)) +
  geom_bar() +
  coord_flip()
```

## too many bars: `fct_lump()`
```{r}
ggplot(
  mpg, 
  aes(x = fct_lump(manufacturer, 5) %>% fct_infreq() %>% fct_rev())
) +
  geom_bar() +
  coord_flip()
```

## order of fill
```{r}
ggplot(mpg, aes(manufacturer, fill = (cyl == 8))) +
  geom_bar() +
  coord_flip()
```

## order of fill
```{r}
mpg %>% 
  mutate(
    cyl_8 = (cyl == 8),
    manufacturer = fct_reorder(manufacturer, cyl_8, sum)
  ) %>% 
  ggplot(aes(manufacturer, fill = cyl_8)) +
  geom_bar() +
  coord_flip()
```

## can you show the top 3 classes and ordered by `cyl != 8`?

## can you swap the `TRUE` & `FALSE` colors of the manufacturer plot?

## `facet_grid()` vs `facet_wrap()`
```{r}

```

## `scale_`[color/fill]`_identity()`

## apect.ratio (coord_fixed or theme), golden ratio 1.6

## zooming in on data ex. boxplot (coord_cartesian)


## Best practices

## Multiple series overtime -> heatmap

## Not everything needs a color

## Highlight the data the user needs to act on

## Give an example of a bad/mediocre chart, ask to partner up and how to 
## improve -> post to google slides?

Resources
R4DS
ggplot extensions
spider/radar plot
gganimate
ggrepel
stackoverflow
